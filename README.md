# Sonar and Flow Sensors - Arduino and MATLAB Codes

## Explanation of Code Files

### Arduino IDE Code

The Arduino code serves as the real-time interface with the physical sensors, responsible for data acquisition and preliminary processing.

* **Sensor Interfacing:** It directly controls and reads data from the **YF-S401 flow sensor** and the **HC-SR04 sonar sensor**. An interrupt is used for the flow sensor to accurately count electrical pulses generated by water flow. For the sonar sensor, it emits ultrasonic pulses and measures the time taken for the echo to return, enabling distance calculation.
* **Data Conversion & Calculation:**
    * From the flow sensor pulses, it calculates the **flow rate** (in liters per minute) and the **total volume** of water that has passed through the system, applying a specific calibration factor (7.5 pulses per liter for the YF-S401).
    * From the sonar sensor's distance measurement, it calculates the **water level** within the container by subtracting the measured distance from the container's total height.
* **Serial Communication:** The calculated values (flow rate, total volume, and water level) are sent to a connected computer via serial communication. The data is formatted as a structured text string, using a pipe (`|`) character as a separator, which facilitates parsing by the MATLAB script. A small delay (100 milliseconds) is included to regulate the data transmission rate.

### MATLAB Code

The MATLAB code functions as the data acquisition, processing, and visualization hub on the computer.

* **Serial Port Setup:** It initiates a serial communication connection with the Arduino, specifying the correct COM port and baud rate (9600 bps). It configures a line feed (`LF`) terminator to identify the end of incoming messages and flushes buffers for a clean communication start.
* **Data Collection Loop:** The central part of the MATLAB code is a loop that continually reads data from the serial port for a predetermined duration. In each iteration:
    * It reads a complete line of data from the Arduino.
    * It employs regular expressions (`regexp`) to parse the incoming text string, extracting numerical values for flow rate, total volume, and water level as transmitted by the Arduino.
* **Unit Conversion & Storage:** The parsed values undergo unit conversions (e.g., flow rate from liters per minute to cubic meters per second, water level from centimeters to meters) and are subsequently stored in pre-allocated arrays (time, flow\_m3s, volume\_L, waterLevel\_cm).
* **Real-time Feedback:** It prints the collected data (time, flow, volume, level) to the MATLAB command window, providing real-time monitoring of the experiment.
* **Data Visualization:** Upon completion of data collection, the MATLAB code generates several plots to visualize the experimental results, including:
    * Water Level vs. Time
    * Flow Rate vs. Water Level
    * Volume vs. Time
    * Relative Efficiency (Flow / Height Ratio) vs. Time
* **Data Saving:** Finally, all collected and processed data is compiled into a table and saved as a CSV file named `experiment_data.csv`, ensuring data persistence and availability for subsequent analysis.
